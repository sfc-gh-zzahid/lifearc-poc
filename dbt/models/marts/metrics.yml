version: 2

semantic_models:
  - name: compound_metrics
    description: "Semantic model for compound library metrics"
    model: ref('mart_compound_analysis')
    defaults:
      agg_time_dimension: created_at
    
    entities:
      - name: drug_likeness_category
        type: primary
        expr: drug_likeness
    
    dimensions:
      - name: drug_likeness
        type: categorical
        expr: drug_likeness
      - name: bbb_penetration
        type: categorical
        expr: avg_bbb_penetration
    
    measures:
      - name: compound_count
        agg: sum
        expr: compound_count
        description: "Total number of compounds"
      - name: avg_logp
        agg: average
        expr: avg_logp
        description: "Average partition coefficient"
      - name: ro5_compliant_pct
        agg: average
        expr: "ro5_compliant_count * 100.0 / NULLIF(compound_count, 0)"
        description: "Percentage of Rule of Five compliant compounds"

  - name: trial_efficacy_metrics
    description: "Semantic model for clinical trial efficacy"
    model: ref('mart_trial_efficacy')
    defaults:
      agg_time_dimension: created_at
    
    entities:
      - name: trial
        type: primary
        expr: trial_id
    
    dimensions:
      - name: trial_id
        type: categorical
        expr: trial_id
    
    measures:
      - name: total_patients
        agg: sum
        expr: patient_count
        description: "Total patients enrolled"
      - name: avg_response_rate
        agg: average
        expr: response_rate
        description: "Average objective response rate"
      - name: avg_pfs
        agg: average
        expr: avg_pfs_months
        description: "Average progression-free survival (months)"
      - name: avg_os
        agg: average
        expr: avg_os_months
        description: "Average overall survival (months)"

metrics:
  - name: total_compounds_screened
    description: "Total compounds in screening library"
    type: simple
    label: "Compounds Screened"
    type_params:
      measure: compound_count

  - name: drug_like_percentage
    description: "Percentage of compounds classified as drug-like"
    type: derived
    label: "Drug-Like %"
    type_params:
      expr: "ro5_compliant_pct"

  - name: clinical_response_rate
    description: "Overall clinical response rate across trials"
    type: simple
    label: "Response Rate"
    type_params:
      measure: avg_response_rate
